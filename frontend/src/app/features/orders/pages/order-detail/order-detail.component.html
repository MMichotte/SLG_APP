<div class="page">
  <h1>ORDER</h1>

  <button pButton pRipple type="button" icon="pi pi-arrow-left" class="p-button-sm p-button-info"
    (click)="router.navigate(['orders']);"></button>

  <div class="control">
    <div class="inline">
      <label class="myLabel">Supplier:</label>
      <p-autoComplete appendTo="body" [(ngModel)]="selectedLightSupplier" [suggestions]="lightSuppliersFiltered"
        (completeMethod)="searchSupplier($event.query)" field="name" [dropdown]="true" (onSelect)="onChangeSupplier()">
      </p-autoComplete>
    </div>

    <div class="inline">
      <label class="myLabel">Status:</label>
      <span class="orderStatus" [ngClass]="{
        'order-status-open':  (order?.status === EOrderStatus.OPEN),
        'order-status-ordered':  (order?.status === EOrderStatus.ORDERED),
        'order-status-PD': (order?.status === EOrderStatus.PD),
        'order-status-closed':       (order?.status === EOrderStatus.CLOSED)
      }">{{order?.status}}</span>
    </div>

    <div class="btns">
      <button pButton pRipple type="button" icon="pi pi-print" label="Print" (click)="print()"></button>
      <button pButton pRipple type="button" icon="pi pi-file-pdf" label="PDF" (click)="true"></button>
    </div>
  </div>

  <p-panel header="Add Product" class="form">
    <app-product-order-form [orderId]="order?.id" [(currentProduct)]="selectedProductOrder"
      [existingProducts]="productOrders" (refreshTable)="refreshProducts()"></app-product-order-form>
  </p-panel>

  <div class="dtable">
    <p-table #dt [columns]="cols" [value]="productOrders" [autoLayout]="true" [paginator]="true" [scrollable]="true"
      [rows]="10" [rowsPerPageOptions]="[10,25,50]" [sortField]="cols[5].field" [sortOrder]="-1" selectionMode="single"
      [(selection)]="selectedProductOrder" styleClass="p-datatable-sm" [loading]="loadingData">

      <ng-template pTemplate="header" let-columns>
        <tr>
          <th *ngFor="let col of columns" [pSortableColumn]="col.field" [ngStyle]="{'width': col.width}">
            {{col.header}}
            <p-sortIcon [field]="col.field"></p-sortIcon>
          </th>
          <th style="width: 6rem"></th>
        </tr>
      </ng-template>

      <ng-template pTemplate="body" let-rowData let-columns="columns">
        <tr [pSelectableRow]="rowData">
          <td *ngFor="let col of columns" [ngStyle]="{'width': col.width}">
            <span [ngClass]="{
                'productStatus': (col.field === 'status'),
                'status-pending': (col.field === 'status' && rowData[col.field] === EProductOrderStatus.PENDING),
                'status-ordered': (col.field === 'status' && rowData[col.field] === EProductOrderStatus.ORDERED),
                'status-received': (col.field === 'status' && rowData[col.field] === EProductOrderStatus.RECEIVED),
                'status-BO': (col.field === 'status' && rowData[col.field] === EProductOrderStatus.BO)
              }">{{rowData[col.field]}}</span>
          </td>
          <td style="width: 6rem;">
            <button pButton pRipple type="button" icon="pi pi-trash" class="p-button-danger p-button-sm"
              title="Remove product" (click)="removeProduct(rowData)"
              *ngIf="rowData.status !== EProductOrderStatus.RECEIVED"></button>
          </td>
        </tr>
      </ng-template>

    </p-table>
  </div>

</div>